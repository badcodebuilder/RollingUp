# CWT in DDoS detection

本实验是[该篇论文](../reading/A%20Novel%20Approach%20for%20distributed%20denial%20of%20service%20defense%20using%20continuous%20wavelet%20transform%20and%20convolutional%20neural%20network%20for%20software-Defined%20network.md)中提到的算法的实现及测试，将连续小波变换应用在DDoS攻击检测中。

## 实验设计

实验中神经网络模型的结构以及参数在论文中已经给出了，因此本实验需要设计的是数据的生成与处理过程，并构建神经网络结构来完成训练与预测。

### 原始数据生成

由于需要网络报文数据，因此最好的办法就是搭建网络结构自行采集。在搭建网络环境的过程中我发现，由于SDN的设计，报文只会在流表未命中的时候才能通过PacketIn发送到控制器，这样就无法通过控制器监视所有报文，那么可行的解决方案如下：

1. 重新编写交换机程序，让控制器可以随时获得交换机中报文的相关信息。不过这样破坏了程序的兼容性，工作量也比较大，而且SDN设计之初就是为了避免这样大量的数据与控制接触。
2. 使用抓包工具，例如wireshark。不过在实际的测试过程中，wireshark无法经受住DoS攻击的报文流，在虚拟机中，我分配了16GB存储，大约8GB用于系统的安装，剩余8GB存储空间在DoS攻击启动后几秒钟就被用完。

上述在实际中操作的问题使得自行搭建SDN网络结构短时间内不太可行，针对问题2我计划在后面编写一个可以调节的DoS攻击工具。

除了搭建网络结构自行采集外，使用现有数据集也是一个可能可行的方案。文献[\[1\]](#ref1)中列举了很多相关的数据集，在比较新的数据集中，我选择了CICDDoS2019和InSDN2020两个数据集，其都是给出了pcap的数据以及使用CIC的工具提取的特征文件。查阅其中特征CSV文件可以发现，数据集将攻击行为与正常行为分离开来记录，但是在论文中提出的数据收集方案是类似于滑动窗口的方法，那么这样在被攻击数据填充的这段数据就没法实现了（pcap文件也是分开记录的）。因此分析数据集也不是很完善的方案，可以作为补充实验来验证。

综上，分析实际数据存在一定的困难，那么这里可以采用模拟的方法生成记录数据。随机产生正常报文流和攻击报文流，并在另一个线程中每隔1秒统计一次。随机产生报文流时10%概率产生攻击报文，90%为正常报文，产生正常报文时，会间隔随机时间发送一次请求，发送较少次数；而产生攻击报文时，会间隔较短时间（1ms）发送一次请求，发送较多次数，并且随机更改源地址。

### 数据处理

按照论文中提出的方案，每隔一段时间（1秒）计算这段时间内的源地址数量，目的地址除以报文总数的比值，形成两个序列。对这两个序列进行CWT，然后将二维数据送入神经网络进行训练和测试。

具体的代码可以查看[这里](#)

## 实验结果

结果的准确度大致都在93%到99%，更加具体地：

|Wavelet|Acc               |
|-------|------------------|
|cgau1  |0.9492481203007519|
|cgau2  |0.9520676691729323|
|cgau3  |0.9586466165413534|
|cgau4  |0.9774436090225563|
|gaus1  |0.9821428571428571|
|gaus2  |0.9924812030075187|
|gaus3  |0.9304511278195489|
|gaus4  |0.9370300751879699|
|mexh   |0.9577067669172933|
|morl   |0.981203007518797 |

整个训练效果非常好，主要是因为数据的可识别特征比较明显，下图是正常报文和攻击报文的CWT特征结果

![feature](./CWT%20in%20DDoS%20detection/feature.png)

可以看到差别非常大

不过论文里面给出的图像特征好像没我差距这么大，下图是论文里面给出的CWT结果

![Paper_feature](./CWT%20in%20DDoS%20detection/paper_feature.png)

## 参考文献

<div id="ref1">[1] Kaur S, Kumar K, Aggarwal N, et al. A comprehensive survey of DDoS defense solutions in SDN: Taxonomy, research challenges, and future directions[J]. Computers & Security, 2021, 110: 102423.</div>
